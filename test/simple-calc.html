<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="A simple calculator for algebraic numbers"/>
    <title>vZome Algebraic Number Calculator</title>
	<link rel="shortcut icon" type="image/x-icon" href="/vzome-sharing/favicon.ico">
	<style>
.inline {
	display: inline;
}
	</style>
	
    <script type="module" src="./vzome-calculator.js"></script>
	<script>

function getSelectedField() {
	const pick = document.getElementById("pickField");
	const value = pick.options[pick.selectedIndex].value;
	return value;
}

function fillPickList() {
	const pick = document.getElementById("pickField");
	let optLabel;
	let optgroup;
	// A valid "field" queryString overrides the default selection
	const selectedField = (new URL(document.location)).searchParams.get("field");
	for(let i=4; i <= 100; i++) {
		switch(i) {
		case 4:
			optLabel = "Polygons...";
			break;
		default:
			optLabel = (i%10 == 0) ? i + "..." : "";
			break;
		}		
		if(optLabel != "") {
			optgroup = document.createElement("optgroup");
			optgroup.label = optLabel;
			pick.appendChild(optgroup);
		}
		let option = document.createElement("option");
		option.value = "polygon" + i;
		option.innerHTML = i + "-gon";
		option.selected = (option.value == selectedField);
		optgroup.appendChild(option);
	}
	
	let values = ["plasticNumber",  "plasticPhi", "snubCube",  "snubDodec",         "superGolden",  "sqrtPhi"];
	let text   = ["Plastic Number", "Plastic φ",  "Snub Cube", "Snub Dodecahedron", "Super Golden", "√φ"     ];
	optgroup = document.createElement("optgroup");
	optgroup.label = "Others...";
	pick.appendChild(optgroup);
	for(const i in values) {
		let option = document.createElement("option");
		option.value = values[i];
		option.innerHTML = text[i];
		option.selected = (option.value == selectedField);
		optgroup.appendChild(option);
	}
	
	values = ["golden", "rootTwo", "rootThree", "heptagon", "edPegg",  "custom"];
	text   = ["Golden", "√2",      "√3",        "Heptagon", "Ed Pegg", "Custom"];
	// Add these fields to the pick list only if specified in queryString, but not otherwise.
	// TODO: getIrrational(i) is not implemented in legacy js fields, but we'll allow it anyway for easier future testing
	for(const i in values) {
		if(selectedField == values[i]) {
			optgroup = document.createElement("optgroup");
			optgroup.label = "Hidden...";
			pick.appendChild(optgroup);
			let option = document.createElement("option");
			option.value = values[i];
			option.innerHTML = text[i];
			option.selected = true;
			optgroup.appendChild(option);
			break;
		}
	}
	onPickFieldChange();
}

function onPickFieldChange() {
	const calc = document.getElementById("calculator2");
	const fieldName = getSelectedField();
	// now that getField() is no longer loaded asynchronously,
	// the fieldName, operator and format setters and getters as well as the logError() method don't initially exist on the calc object
	// but I can set the corresponding attribute and it works as expected but I prefer the setter syntax
	// TODO: figure out how to be able to set calc.fieldName without testing to see if it exists yet...
	// or I could just eliminate the getters and setters and use only attributes to control it.
	if(calc.fieldName) {
		//console.log("Assigning the calc.fieldName property setter a value of '" + fieldName + "'");
		calc.fieldName = fieldName;
	} else {
		//console.log("Setting the calc.field-name attribute a value of '" + fieldName + "'");
		calc.setAttribute("field-name", getSelectedField()); // this 
	}
}

function showNumberFormat() {
  // TODO: match the rules by selectorText, not by ordinal
  // See https://stackoverflow.com/questions/324486/how-do-you-read-css-rule-values-with-javascript
  const radios = document.getElementsByName("pickNumberFormat");
  for (let i = 0, length = radios.length; i < length; i++) {
	const selected = radios[i].checked;
	if(selected) {
		document.getElementById("calculator2").format = radios[i].value;
	}
	// TODO:
	//let style = document.styleSheets['algebraicNumberFormats'].rules[i].style;
	//style.display = selected ? "table-cell" : "none";
  }
}

window.addEventListener("load", () => 
{
	fillPickList();
});
	</script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div><h1>vZome Algebraic Number Calculator</h1></div>

  <div id='controls'>
	<fieldset class="inline">
    <legend>Algebraic Field</legend>
	<select id="pickField" onchange="onPickFieldChange()"><!-- options are generated by script --></select>
	</fieldset>
	
	<fieldset class="inline">
    <legend>Number Format</legend>
	<input type="radio" id="numFormat1" name="pickNumberFormat" value="alg" onclick="showNumberFormat()" checked><label for="numFormat1">Algebraic Number</label>
	<input type="radio" id="numFormat2" name="pickNumberFormat" value="dec" onclick="showNumberFormat()"        ><label for="numFormat2">Decimal</label>
	<input type="radio" id="numFormat3" name="pickNumberFormat" value="tdf" onclick="showNumberFormat()"        ><label for="numFormat3">Trailing Denominator</label>
	</fieldset>
  </div>

  <br/>
  
  <fieldset class="inline">
    <legend>Calculator1 (fixed field)</legend>
	<!-- legacy golden field throws 'unimplemented JsAlgebraicField.getIrrational' so use polygon5 -->
    <vzome-calculator id="calculator1" field-name="polygon5"/>
  </fieldset>
  <br/>
  <fieldset class="inline">
    <legend>Calculator2 (dynamic field)</legend>
    <vzome-calculator  id="calculator2" field-name="polygon6"/>
  </fieldset>
  	
  </body>
</html>